
## Data dictionary

| Variable Name                                                                                                                                                                                          | Description                                                                                                       | Notes                                                                                                                                                                |                                                                                                                                                                                                                                       |                                                                                                                             |
|---|---|---|---|---|
| `ApplicationSerialNumber` (K)                                                                                                                                                                        | Clipper card number                                                                                          | Used for chaining information                                                                                                                                         |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `ApplicationTransactionSequenceNumber` (L)                                                                                                                                                           | Incremented count of transactions                                                     | Includes fare transactions and add value transactions                                        | Initialized at 1                                                                                                                                                                                                                         |                                                                                                                                   |
| `GenerationTime` (H)                                                                                                                                                                                 | UTC Time: Time of transaction                                                                                                                                                                                                                     | [Subtract 8 hours (or 7 in the summer) to get local time](https://github.com/BayAreaMetro/clpr/blob/master/inst/sql/day_fares.sql#L4)                                                                                                                                                                                     | [Subtract 11 hours (or 10 in the summer) to get the date of service](https://github.com/BayAreaMetro/clpr/blob/master/R/extract.R#L67-L70)    | [Subtract generation times to get trip time for dual tag transactions](https://github.com/BayAreaMetro/clpr/blob/master/R/complete_trip.R#L10)
| `OperatorID` (B)                                                                                                                                                                                     | Operator                                                   | [Decoded in Participant parameter table](https://github.com/BayAreaMetro/clpr/blob/master/R/extract.R#L53-L54)                                                                                                                                                                      |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `RecordType` (I)                                                                                                                                                                                     | Always 1                                                      |                                                                                                                                                                       |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `Subtype` (J)                                                                                                                                                                                        | From 1-6: Tag system description | <ol><li>Single tag</li><li>Zone-based dual tag entry</li><li>Zone-based dual tag exit</li><li>Location-specific dual tag entry</li><li>Location-specific dual tag exit</li><li>Location-specific single tag</li></ol>                                                                                                                                                       |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `PurseAmount` (V)                                                                                                                                                                                    | Amount deducted from purse based on subtype                                                    | <ol><li>Flat fare deducted</li><li>Entry: Maximum zone fare deducted</li><li>Exit: [Maximum minus actual fare *refunded*](https://github.com/BayAreaMetro/clpr/blob/master/R/complete_trip.R#L22)</li><li>Entry: No deduction</li><li>Exit: Fare deducted</li><li>Location-specific fare deducted</li></ol> |  |                                                                                                                                   |
| `RideAnnulled` (AA)                                                                                                                                                                                  | Boolean: 1 if refund issued                                                                                      |                                                                                                                                       |                                                                                                                                                                                                                                             |                                                                                                                                   |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `StartTime` (AE)                                                                                                                                                                                     | UTC Time: Time trip began                                                                                              | Records entry time for a trip | Same as `GenerationTime` except for transactions with exit subtypes (3 and 5) to                                                                                                                                                          |                                                                                                                                   |
| `RouteID` (F)	| Route: for buses                                                                                                             |  [Decoded in Route parameter table](https://github.com/BayAreaMetro/clpr/blob/master/R/extract.R#L55-L56)			                                                                                                                                                                        |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `ContractID` (O)	| Passes/products to serve as alternate forms of payment| [Decoded in Product map parameter table](https://github.com/BayAreaMetro/clpr/blob/master/R/products.R#L13-L25)                                                                                                                                          |                                                                                                                                                                       |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `GenericECashPurseBalance` (U)                                                                                                                                                                       | Purse Balance (BART only)                                                                                                    |                                                                                                                                                                       |                                                                                                                                                                                                                                             |                                                                                                                                   |
| `GenericECashPurseAmount` (T)                                                                                                                                                                        | Purse Amount (BART only)                                                                                                     | Whether it is a deduction vs balance is indicated by the subtype                                                                                                                                              |                                                                                                                                                                              |                                                                                                                                   |
| `OriginLocation` (AB)                                                                                                                                                                                | Station or Zone: trip origin                                                                                                                                                     | [Decoded in Location parameter table](https://github.com/BayAreaMetro/clpr/blob/master/R/extract.R#L57-L58)                                                                                                                                                                                                                                            |                                                                                                                                   |
| DestinationLocation (AC)                                                                                                                                                                           | Station or Zone: trip destination                                   | [Decoded in Location parameter table](https://github.com/BayAreaMetro/clpr/blob/master/R/extract.R#L57-L58)                                                                            | Defaults to 65535 for transactions with entry subtypes (2 & 4)                                                                                                                                                                                                                                             |                                                                                                                                   |
| ProductCategory (Q)                                                                                                                                                                                | eCash vs Product vs Ridebook                                                                                 |                                                                                                                                                                       |                                                                                                                                                                                                                                             |                                                                                                                                   |

### Key Fields

#### Generationtime

This field is on the transaction tables (e.g. `ctp.y2015`).

It is the timestamp of the transaction on the transaction tables.

It is in UTC timezone.

#### Human-readable names for transactions

The following is a sketch of how to put human-readable names on transactions or summaries of them.

What follows are pseudocode joins in SQL.

If possible, these joins should happen after a relevant filter on the transactions table, for performance reasons.

These can be combined as needed.

These are meant as examples only. The user should check them as needed before use.


## Notes



* Berkeley institution ID's don't go into effect on this table until August 1, 2017
